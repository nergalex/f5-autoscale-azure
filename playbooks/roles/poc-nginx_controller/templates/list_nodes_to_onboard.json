[
  {%- for cur_vm in, list_instances_to_onboard, -%}


  {%- endfor -%}



  "metadata": {
    "name": "gw_{{item.app.name| lower}}",
    "displayName": "Gateways {{item.app.name | lower}}",
    "description": "Generated by CMP"
  },
  "desiredState": {
    "ingress": {
      {%- if var_tls_enabled is defined and var_tls_enabled -%}
      "tls": {
        "certRef": {
          "ref": "/services/environments/{{ extra_env_prefix | lower }}{{ item.app.environment | lower }}/certs/crt_{{ item.app.name | lower }}"
        }
      },
      {%- endif -%}
      "uris": {
      {%- if var_tls_enabled is defined and var_tls_enabled %}
        "https://{{item.app.name | lower}}.{{item.app.domain | lower}}": {
      {%- else %}
        "http://{{item.app.name | lower}}.{{item.app.domain | lower}}": {
      {%- endif %}
          "matchMethod": "EXACT"
        }
      },
      "placement": {
        "instanceRefs": [
          {%- for gw in var_instance_ids -%}
          {
            "ref": "{{ gw.ref }}"
          }{%- if not loop.last -%},{% endif %}
          {%- endfor -%}
        ]
      }
    }
  }
}
